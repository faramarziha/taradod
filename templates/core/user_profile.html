{% extends "core/base.html" %}
{% load static %}
{% block title %}پروفایل کاربر{% endblock %}
{% block content %}
<div class="card page page-md profile-card fade-in">
  <div class="profile-banner">
    <img class="profile-avatar" src="{% if user.face_image %}{{ user.face_image.url }}{% else %}{% static 'core/avatar.png' %}{% endif %}" alt="{{ user.get_full_name }}">
    <h2 class="page-title">
      <i class="fa fa-user"></i>
      {{ user.get_full_name }}
    </h2>
    <p class="profile-meta">کد پرسنلی: {{ user.personnel_code }} | کد ملی: {{ user.national_id }}</p>
  </div>

  <div class="today-status-card status-{{ today_status.status }}">
    <h3>وضعیت امروز شما</h3>
    <p>
      {% if today_status.status == 'present' %}
        حاضر{% if today_status.first_in %} - اولین ورود: {{ today_status.first_in|time:"H:i" }}{% endif %}
      {% elif today_status.status == 'absent' %}
        غایب
      {% elif today_status.status == 'leave' %}
        مرخصی
      {% else %}
        روز تعطیل
      {% endif %}
    </p>
  </div>

  <div class="quick-actions">
    <h3 class="section-title">دسترسی سریع</h3>
    <div class="profile-actions">
      <a class="btn" href="{% url 'my_logs' %}"><i class="fa fa-list-alt" style="margin-left:0.4rem;"></i> گزارش کامل تردد</a>
      <a class="btn" href="{% url 'leave_request' %}"><i class="fa fa-plus-circle" style="margin-left:0.4rem;"></i> درخواست جدید</a>
      <a class="btn" href="{% url 'user_leave_requests' %}"><i class="fa fa-clipboard-list" style="margin-left:0.4rem;"></i> پیگیری درخواست‌ها</a>
    </div>
  </div>

  <div class="recent-events">
    <h3 class="section-title">آخرین اعلان‌ها و درخواست‌ها</h3>
    <ul>
      {% for e in recent_events %}
        <li>{{ e.message }}</li>
      {% empty %}
        <li>موردی نیست</li>
      {% endfor %}
    </ul>
  </div>

  <div class="monthly-stats">
    <h3 class="section-title">آمار عملکرد من در این ماه</h3>
    <div class="stats-cards">
      <div class="stat-card">
        <span class="label">ساعات کاری ثبت شده</span>
        <span class="value">{{ monthly_stats.total_hours }}</span>
      </div>
      <div class="stat-card">
        <span class="label">مجموع دقایق تأخیر</span>
        <span class="value">{{ monthly_stats.total_delay }}</span>
      </div>
      <div class="stat-card">
        <span class="label">روزهای غیبت</span>
        <span class="value">{{ monthly_stats.absent_days }}</span>
      </div>
    </div>
  </div>

  <div class="profile-actions" style="margin-top:1rem;">
    <a class="btn" href="{% url 'user_inquiry' %}"><i class="fas fa-chevron-right" style="margin-left:0.4rem;"></i> بازگشت</a>
  </div>
</div>
{% endblock %}

