{% extends "core/base.html" %}
{% load static %}
{% load jformat %}
{% block title %}پروفایل کاربر{% endblock %}
{% block content %}
<div class="card page page-md profile-card fade-in">
  <div class="profile-banner">
    <img class="profile-avatar" src="{% if user.face_image %}{{ user.face_image.url }}{% else %}{% static 'core/avatar.png' %}{% endif %}" alt="{{ user.get_full_name }}">
    <div class="profile-header-info">
      <h2 class="page-title"><i class="fa fa-user"></i> پروفایل {{ user.get_full_name }}</h2>
      <div class="profile-ids">
        <span>کد پرسنلی: {{ user.personnel_code }}</span>
        <span>کد ملی: {{ user.national_id }}</span>
      </div>
    </div>
  </div>

  <div class="status-widget status-{{ today_status.color }}">
    <h3>وضعیت امروز شما</h3>
    <p>
      {{ today_status.label }}
      {% if today_status.in_time %}- اولین ورود: {{ today_status.in_time|time:"H:i" }}{% endif %}
    </p>
  </div>

  <div class="recent-widget">
    <h3>آخرین اعلان‌ها و درخواست‌ها</h3>
    <ul>
      {% for n in recent_items %}
      <li>{{ n.message }}</li>
      {% empty %}
      <li>اعلان جدیدی وجود ندارد.</li>
      {% endfor %}
    </ul>
  </div>

  <div class="stats-widget">
    <h3>آمار عملکرد من در این ماه</h3>
    <div class="stats-cards">
      <div class="stat-card"><span class="label">ساعات کاری ثبت شده</span><span class="value">{{ monthly_stats.total_hours }}</span></div>
      <div class="stat-card"><span class="label">دقایق تأخیر</span><span class="value">{{ monthly_stats.tardy_minutes }}</span></div>
      <div class="stat-card"><span class="label">روزهای غیبت</span><span class="value">{{ monthly_stats.absent_days }}</span></div>
      <div class="stat-card"><span class="label">روزهای مرخصی</span><span class="value">{{ monthly_stats.leave_days }}</span></div>
    </div>
  </div>

  <div class="quick-actions">
    <h3>دسترسی سریع</h3>
    <a class="btn" href="{% url 'my_logs' %}"><i class="fa fa-list-alt" style="margin-left:0.4rem;"></i> مشاهده گزارش کامل تردد</a>
    <a class="btn" href="{% url 'leave_request' %}"><i class="fa fa-calendar-plus" style="margin-left:0.4rem;"></i> ثبت درخواست جدید</a>
    <a class="btn" href="{% url 'my_leave_requests' %}"><i class="fa fa-calendar-check" style="margin-left:0.4rem;"></i> پیگیری درخواست‌های من</a>
  </div>

  <div class="profile-actions">
    <a class="btn" href="{% url 'user_inquiry' %}"><i class="fas fa-chevron-right" style="margin-left:0.4rem;"></i> بازگشت</a>
  </div>
</div>
{% endblock %}
