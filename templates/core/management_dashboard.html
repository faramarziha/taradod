{% extends "core/base_management.html" %}
{% block title %}داشبورد مدیریت{% endblock %}
{% block management_content %}
<h2 class="page-title">
  <i class="fas fa-chart-bar"></i> داشبورد مدیریت
</h2>

<div class="options-carousel-wrapper fade-in">
  <button class="carousel-btn prev" type="button">&#10094;</button>
  <div class="options-carousel">
    <a href="{% url 'manager_cartable' %}"><i class="fas fa-inbox"></i> کارتابل من</a>
    <a href="{% url 'attendance_status' %}"><i class="fas fa-user-check"></i> ترددهای کارکنان</a>
    <a href="{% url 'daily_performance' %}"><i class="fas fa-calendar-day"></i> کارکرد روزانه</a>
    <a href="{% url 'manager_requests' %}"><i class="fas fa-list"></i> درخواست‌ها</a>
    <a href="{% url 'periodic_performance' %}"><i class="fas fa-calendar-alt"></i> کارکرد دوره‌ای</a>
    <a href="{% url 'device_settings' %}"><i class="fas fa-id-card"></i> دستگاه‌ها</a>
    <a href="{% url 'shifts' %}"><i class="fas fa-clock"></i> شیفت‌ها</a>
    <a href="{% url 'policies' %}"><i class="fas fa-gavel"></i> سیاست‌ها</a>
    <a href="{% url 'work_groups' %}"><i class="fas fa-layer-group"></i> گروه‌ها</a>
    <a href="{% url 'units' %}"><i class="fas fa-building"></i> واحدها</a>
    <a href="{% url 'management_users' %}"><i class="fas fa-users"></i> پرسنل</a>
    <a href="{% url 'request_types' %}"><i class="fas fa-list-alt"></i> انواع درخواست</a>
    <a href="{% url 'general_settings' %}"><i class="fas fa-cogs"></i> تنظیمات</a>
    <a href="{% url 'report_attendances' %}"><i class="fas fa-clock"></i> گزارش تردد</a>
    <a href="{% url 'report_requests' %}"><i class="fas fa-envelope-open-text"></i> گزارش درخواست</a>
    <a href="{% url 'report_daily_performance' %}"><i class="fas fa-calendar-day"></i> گزارش کارکرد</a>
    <a href="{% url 'report_performance_calculation' %}"><i class="fas fa-calculator"></i> محاسبه کارکرد</a>
    <a href="{% url 'report_annual_requests' %}"><i class="fas fa-chart-line"></i> سالیانه</a>
    <a href="{% url 'my_account' %}"><i class="fas fa-user-cog"></i> حساب من</a>
  </div>
  <button class="carousel-btn next" type="button">&#10095;</button>
</div>

<div class="card dashboard-panel fade-in">
  <h3 class="panel-title"><i class="fas fa-chart-pie"></i> آمار کلی</h3>
  <div class="dashboard-stats">
    <div class="dashboard-card">
      <i class="fas fa-users"></i>
      <span class="value">{{ total_users }}</span>
      <span class="label">کل کاربران</span>
    </div>
    <div class="dashboard-card">
      <i class="fas fa-clock"></i>
      <span class="value">{{ today_logs }}</span>
      <span class="label">تردد امروز</span>
    </div>
    <div class="dashboard-card">
      <i class="fas fa-user-slash"></i>
      <span class="value">{{ users_without_face }}</span>
      <span class="label">بدون ثبت چهره</span>
    </div>
    <div class="dashboard-card">
      <i class="fas fa-user-check"></i>
      <span class="value">{{ present_count }}</span>
      <span class="label">حاضر امروز</span>
    </div>
    <div class="dashboard-card">
      <i class="fas fa-user-times"></i>
      <span class="value">{{ absent_count }}</span>
      <span class="label">غایب امروز</span>
    </div>
    <div class="dashboard-card">
      <i class="fas fa-plane"></i>
      <span class="value">{{ leave_count }}</span>
      <span class="label">در مرخصی</span>
    </div>
    <div class="dashboard-card">
      <i class="fas fa-hourglass-half"></i>
      <span class="value">{{ total_hours }}</span>
      <span class="label">مجموع ساعات</span>
    </div>
  </div>
</div>

<div class="card fade-in">
  <h3 class="panel-title"><i class="fas fa-bell"></i> هشدارها</h3>
  <ul class="alerts-list">
    {% for u in tardy_users %}
      <li>{{ u.get_full_name }} - {{ u.personnel_code }} دیرکرد در ورود</li>
    {% endfor %}
    {% if pending_edits %}
      <li>{{ pending_edits }} درخواست ویرایش تردد در انتظار</li>
    {% endif %}
    {% if pending_leaves %}
      <li>{{ pending_leaves }} درخواست مرخصی در انتظار</li>
    {% endif %}
    {% if suspicious_today %}
      <li>{{ suspicious_today }} مورد عدم تطابق چهره</li>
    {% endif %}
    {% if not tardy_users and not pending_edits and not pending_leaves and not suspicious_today %}
      <li>هشداری وجود ندارد.</li>
    {% endif %}
  </ul>
</div>

<div class="status-grid card fade-in">
  <div class="status-card">
    <h4>حاضرین امروز</h4>
    <ul>
      {% for u in present_users %}
        <li>{{ u.get_full_name }} - {{ u.personnel_code }}</li>
      {% empty %}
        <li>موردی ثبت نشده است</li>
      {% endfor %}
    </ul>
  </div>
  <div class="status-card">
    <h4>غایبین امروز</h4>
    <ul>
      {% for u in absent_users %}
        <li>{{ u.get_full_name }} - {{ u.personnel_code }}</li>
      {% empty %}
        <li>همه حاضرند</li>
      {% endfor %}
    </ul>
  </div>
  <div class="status-card">
    <h4>در مرخصی</h4>
    <ul>
      {% for u in leave_users %}
        <li>{{ u.get_full_name }} - {{ u.personnel_code }}</li>
      {% empty %}
        <li>موردی نیست</li>
      {% endfor %}
    </ul>
  </div>
</div>

<div class="card fade-in" style="margin-top:2rem;">
  <canvas id="logsChart" height="120"></canvas>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const logLabels = {{ date_range_json|safe }};
const logData = {{ daily_logs_json|safe }};
new Chart(document.getElementById('logsChart').getContext('2d'), {
  type: 'line',
  data: {
    labels: logLabels,
    datasets: [{
      label: 'تعداد تردد',
      data: logData,
      borderColor: '#3e95cd',
      fill: false
    }]
  },
  options: {scales: {y: {beginAtZero:true}}}
});
</script>
<script src="{% static 'core/management.js' %}"></script>
{% endblock %}
