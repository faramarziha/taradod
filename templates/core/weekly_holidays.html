{% extends "core/base_management.html" %}
{% block title %}روزهای تعطیل{% endblock %}
{% block management_content %}
<h2 class="page-title"><i class="fas fa-calendar-day"></i> تنظیم روزهای تعطیل</h2>
<form method="post" class="card page page-sm" style="margin-top:1rem;">
  {% csrf_token %}
  <h3 class="panel-title">{{ form.days.label }}</h3>
  <div id="week-calendar" class="week-calendar">
    {% for checkbox in form.days %}
      <label class="day-tile">{{ checkbox.tag }}<span>{{ checkbox.choice_label }}</span></label>
    {% endfor %}
  </div>
  <div id="official-holidays" class="official-holidays"></div>
  <div class="profile-actions">
    <button class="btn" type="submit">ذخیره</button>
  </div>
</form>

<style>
  .week-calendar{display:flex;gap:0.5rem;margin-bottom:1rem;justify-content:space-between;}
  .day-tile{border:1px solid #ccc;border-radius:4px;padding:0.5rem 1rem;cursor:pointer;position:relative;}
  .day-tile input{display:none;}
  .day-tile.selected{background:var(--color-primary);color:#fff;}
  .official-holidays{margin-top:1rem;font-size:0.9rem;}
</style>
<script>
  document.querySelectorAll('.day-tile').forEach(function(lbl){
    var cb = lbl.querySelector('input');
    lbl.classList.toggle('selected', cb.checked);
    lbl.addEventListener('click', function(e){
      if(e.target !== cb){
        cb.checked = !cb.checked;
      }
      lbl.classList.toggle('selected', cb.checked);
    });
  });
  fetch('https://api.codebazan.ir/holiday/?json=1')
    .then(r=>r.json())
    .then(data=>{
      var cont=document.getElementById('official-holidays');
      if(data && data.result){
        data.result.slice(0,7).forEach(function(item){
          var div=document.createElement('div');
          div.textContent=item.date+' - '+item.text;
          cont.appendChild(div);
        });
      }
    })
    .catch(console.error);
</script>
{% endblock %}
