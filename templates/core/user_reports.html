{% extends "core/base_management.html" %}
{% load jformat %}
{% block title %}گزارش کاربران{% endblock %}
{% block management_content %}
<h2 style="text-align:right;">
  <i class="fas fa-file-alt" style="margin-left:0.5rem;"></i> گزارش کاربران
</h2>
<a href="{% url 'monthly_profile' %}" class="btn" style="margin-top:0.5rem;">پروفایل ماهانه کاربر</a>
<div class="dashboard-stats">
  <div class="dashboard-card">
    <h3>{{ active_users }}</h3>
    کاربر فعال
  </div>
  <div class="dashboard-card">
    <h3>{{ inactive_users }}</h3>
    کاربر غیرفعال
  </div>
  <div class="dashboard-card">
    <h3>{{ users_with_face }}</h3>
    با ثبت چهره
  </div>
  <div class="dashboard-card">
    <h3>{{ users_without_face }}</h3>
    بدون ثبت چهره
  </div>
</div>

<form method="get" class="card report-filter" style="margin-top:1rem;">
  <div class="form-grid">
    <div>{{ form.start_date.label_tag }}{{ form.start_date }}</div>
    <div>{{ form.end_date.label_tag }}{{ form.end_date }}</div>
    <div>{{ form.groups.label_tag }}{{ form.groups }}</div>
    <div>{{ form.shifts.label_tag }}{{ form.shifts }}</div>
    <div>{{ form.users.label_tag }}{{ form.users }}</div>
  </div>
  <button type="submit" class="btn">تولید گزارش</button>
</form>

<div class="card report-result" style="margin-top:1rem;">
<div class="table-responsive">
<table class="management-table">
  <thead>
    <tr>
      <th>کاربر</th>
      <th>تاریخ</th>
      <th>ساعت</th>
      <th>نوع</th>
      <th>ثبت‌کننده</th>
    </tr>
  </thead>
  <tbody>
    {% for log in logs %}
    <tr>
      <td>{{ log.user.get_full_name }} - {{ log.user.personnel_code }}</td>
      <td>{{ log.timestamp|jformat:"%Y/%m/%d" }}</td>
      <td>{{ log.timestamp|time:"H:i" }}</td>
      <td>{% if log.log_type == 'in' %}ورود{% else %}خروج{% endif %}</td>
      <td>{% if log.source == 'self' %}کاربر{% elif log.source == 'auto' %}سیستم{% else %}مدیر{% endif %}</td>
    </tr>
    {% empty %}
    <tr><td colspan="5">ترددی ثبت نشده است.</td></tr>
    {% endfor %}
  </tbody>
</table>
</div>
</div>
{% endblock %}

{% block extra_js %}
{{ form.media }}
{% endblock %}
